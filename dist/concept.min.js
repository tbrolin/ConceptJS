/*! concept 2014-05-22 */
var concept=function(){"use strict";var a={},b={};["Arguments","Function","String","Number","Date","RegExp"].forEach(function(a){b["is"+a]=function(c){return b.toString.call(c)==="[object "+a+"]"}}),b.isObject=function(a){return a===Object(a)};var c=function(a,b){return b&&b[a.type]||(b={},b[a.type]=a.message||"There was an unknown error."),a.message="ERROR: "+b[a.type],a.time=new Date,a.type=a.type||"UNIT-ERROR",a.origin=a.origin||"UNKNOWN",a.rootCause=a.rootCause||"UNKNOWN",a},d=function(){var b,d,e,f=Array.prototype.slice.call(arguments);if(0===f.length)return"0.1.0";if(b=f.shift(),d=b.scope&&b.deps&&b.fn?b:a[b],!d)throw c({type:"CONCEPT-NOT-FOUND",origin:"con.concept.js",message:'Concept "'+b+'" is not defined.'});return d.deps.forEach(function(b){if(!a[b])throw c({type:"DEPENDENCY-NOT-FOUND",origin:"con.concept.js",message:"Concept "+b+" is not defined."})}),e={},e.unit=d.scope,d.fn.apply(e,f)};return d.define=function(){var d="anonymous"+(new Date).getTime(),e=[],f=function(){return{}},g=Array.prototype.slice.call(arguments);if(1===g.length)if(b.isFunction(g[0]))f=g[0];else if(b.isString(g[0]))d=g[0];else{if(!g[0].forEach)throw c({type:"WRONG-ARGUMENTS",origin:"con.concept.js",message:"Could not define concept from arguments."});e=g[0]}else if(2===g.length)if(b.isString(g[0])&&g[1].forEach)d=g[0],e=g[1];else if(b.isString(g[0])&&b.isFunction(g[1]))d=g[0],f=g[1];else{if(!g[0].forEach||!b.isFunction(g[1]))throw c({type:"WRONG-ARGUMENTS",origin:"con.concept.js",message:"Could not define concept from arguments."});e=g[0],f=g[1]}else if(g.length>2){if(!(b.isString(g[0])&&g[1].forEach&&b.isFunction(g[2])))throw c({type:"WRONG-ARGUMENTS",origin:"con.concept.js",message:"Could not define concept from arguments."});d=g[0],e=g[1],f=g[2]}return a[d]={scope:{},deps:e,fn:f},a[d]},d.error=c,d.utils=b,d}();if("undefined"!=typeof module&&module.exports&&(module.exports=concept),"undefined"==typeof window)var concept=require("./con.concept"),asap=require("asap");concept.define("units.promise",[],function(){var a={},b=concept.utils.isObject,c=concept.utils.isFunction,d=function(a){return b(a)||c(a)},e=asap||function(a){setTimeout(a,0)};return a.defer=function(){function b(){"resolved"===j&&k.resolve?(k.resolve(h),k.resolve=void 0):"rejected"===j&&k.reject&&(k.reject(h),k.reject=void 0)}function f(a,c){"pending"===j&&(h=a,j=c,b())}function g(a,b){var e=!1;try{if(i.promise===a)throw new TypeError;if(d(a)){var h=a.then;if(c(h))return void h.apply(a,[function(a){e||(g(a,"resolved"),e=!0)},function(a){e||(g(a,"rejected"),e=!0)}])}f(a,b),e=!0}catch(j){e||(f(j,"rejected"),e=!0)}}var h,i={},j="pending",k={};return i.resolve=function(a){"pending"===j&&g(a,"resolved")},i.reject=function(a){"pending"===j&&g(a,"rejected")},i.promise={then:function(d,f){var g=a.defer();c(f)||(f=function(a){return a}),c(d)||(d=f);var h={onresolve:k.resolve,onreject:k.reject};return k.resolve=function(a){h.onresolve&&h.onresolve(a),e(function(){try{g.resolve(d(a))}catch(b){g.reject(b)}})},k.reject=function(a){h.onreject&&h.onreject(a),e(function(){try{g.resolve(f(a))}catch(b){g.reject(b)}})},b(),g.promise}},i},a});